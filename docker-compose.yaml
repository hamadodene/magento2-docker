version: '3.9'
networks:
  nginxproxy-net:
    external: true

services:
  magento:
    build: 
      context: .
      dockerfile: ./dockerfiles/magento.dockerfile
    container_name: magento
    volumes:
      - ./src:/var/www/html:rw
      - nginx:/etc/nginx/http.d:ro
    networks:
      - "nginxproxy-net"
    ports:
      - '80:80'
    env_file:
      - ./env/magento.env
  composer:
    build:
      context: ./dockerfiles
      dockerfile: composer-utility.dockerfile  
    volumes: 
      - ./src:/var/www/html      
  mysql:
    image: mysql
    container_name: mysql-magento
    restart: always
    env_file:
      - ./env/mysql.env
    networks:
      - "nginxproxy-net"
    ports:
      -  "3306:3306"
  elasticsearch:
    image: elasticsearch:8.5.3
    container_name: elasticsearch-magento
    networks:
      - "nginxproxy-net"
    environment:
      - discovery.type=single-node
    ports:
      - "9200:9200"
      - "9300:9300"  
volumes:
  nginx: